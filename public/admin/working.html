<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS Funcional - Alexandre Guimar√£es</title>
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .cms-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        .cms-header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .cms-header p {
            margin: 0.25rem 0 0 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        #nc-root {
            min-height: calc(100vh - 80px);
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 2rem;
            color: #d32f2f;
            background-color: #ffebee;
            border-radius: 8px;
            margin: 2rem;
        }
        
        .success {
            text-align: center;
            padding: 2rem;
            color: #2e7d32;
            background-color: #e8f5e8;
            border-radius: 8px;
            margin: 2rem;
        }
        
        .version-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: #4caf50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        .status-info {
            position: fixed;
            top: 50px;
            left: 10px;
            background-color: #2196f3;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        .debug-link {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            text-decoration: none;
            z-index: 1000;
        }
        
        .script-sources {
            position: fixed;
            top: 90px;
            left: 10px;
            background-color: #9c27b0;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="cms-header">
        <h1>Blog - Alexandre Guimar√£es</h1>
        <p>CMS Funcional - M√∫ltiplas Fontes</p>
    </div>
    
    <!-- Informa√ß√£o da vers√£o -->
    <div class="version-info">Decap CMS v2.14.0</div>
    
    <!-- Status do carregamento -->
    <div id="status" class="status-info">üîÑ Verificando...</div>
    
    <!-- Fonte do script -->
    <div id="script-source" class="script-sources">üì° Tentando CDN...</div>
    
    <!-- Link para debug -->
    <a href="index.html" class="debug-link">Debug</a>
    
    <div id="nc-root">
        <div class="loading">
            <p>Inicializando CMS...</p>
        </div>
    </div>
    
    <script>
        // Vari√°veis de status
        let identityLoaded = false;
        let cmsLoaded = false;
        let configLoaded = false;
        let scriptSource = '';
        
        // Fun√ß√£o para atualizar status
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `status-info ${type}`;
            }
        }
        
        // Fun√ß√£o para atualizar fonte do script
        function updateScriptSource(source) {
            scriptSource = source;
            const sourceEl = document.getElementById('script-source');
            if (sourceEl) {
                sourceEl.textContent = `üì° ${source}`;
            }
        }
        
        // Fun√ß√£o para carregar script do CMS
        function loadCMSScript() {
            const sources = [
                'https://unpkg.com/decap-cms@2.14.0/dist/decap-cms.js',
                'https://cdn.jsdelivr.net/npm/decap-cms@2.14.0/dist/decap-cms.js',
                'https://unpkg.com/netlify-cms@2.14.0/dist/netlify-cms.js',
                'https://cdn.jsdelivr.net/npm/netlify-cms@2.14.0/dist/netlify-cms.js'
            ];
            
            let currentSource = 0;
            
            function tryNextSource() {
                if (currentSource >= sources.length) {
                    updateScriptSource('‚ùå Todas as fontes falharam');
                    updateStatus('‚ùå CMS n√£o conseguiu carregar de nenhuma fonte', 'error');
                    return;
                }
                
                const source = sources[currentSource];
                updateScriptSource(`Tentando: ${source.split('/').pop()}`);
                
                const script = document.createElement('script');
                script.src = source;
                script.onload = function() {
                    updateScriptSource(`‚úÖ Carregado de: ${source.split('/').pop()}`);
                    updateStatus('‚úÖ Script do CMS carregado!', 'success');
                    checkCMS();
                };
                script.onerror = function() {
                    updateScriptSource(`‚ùå Falhou: ${source.split('/').pop()}`);
                    currentSource++;
                    setTimeout(tryNextSource, 1000);
                };
                
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        // Fun√ß√£o para verificar Netlify Identity
        function checkIdentity() {
            if (typeof netlifyIdentity !== 'undefined') {
                identityLoaded = true;
                updateStatus('‚úÖ Identity carregado', 'success');
                
                // Inicializar Identity
                try {
                    netlifyIdentity.init();
                    updateStatus('‚úÖ Identity inicializado', 'success');
                } catch (error) {
                    updateStatus('‚ùå Erro no Identity: ' + error.message, 'error');
                }
            } else {
                updateStatus('‚è≥ Aguardando Identity...', 'loading');
            }
        }
        
        // Fun√ß√£o para verificar CMS
        function checkCMS() {
            if (typeof CMS !== 'undefined') {
                cmsLoaded = true;
                updateStatus('‚úÖ CMS carregado', 'success');
                
                // Limpar √°rea de loading
                const ncRoot = document.getElementById('nc-root');
                if (ncRoot) {
                    ncRoot.innerHTML = '';
                }
                
                updateStatus('üéâ CMS funcionando!', 'success');
                
            } else {
                updateStatus('‚è≥ Aguardando CMS...', 'loading');
            }
        }
        
        // Fun√ß√£o para verificar configura√ß√£o
        function checkConfig() {
            fetch('./config-simple.yml')
                .then(response => {
                    if (response.ok) {
                        configLoaded = true;
                        updateStatus('‚úÖ Config carregada', 'success');
                    } else {
                        updateStatus('‚ùå Erro na config', 'error');
                    }
                })
                .catch(error => {
                    updateStatus('‚ùå Erro: ' + error.message, 'error');
                });
        }
        
        // Verifica√ß√µes iniciais
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('üîÑ DOM carregado, verificando...', 'loading');
            
            // Verificar configura√ß√£o
            checkConfig();
            
            // Verificar Identity
            checkIdentity();
            
            // Carregar script do CMS
            loadCMSScript();
        });
        
        // Verifica√ß√µes peri√≥dicas
        setInterval(() => {
            if (!identityLoaded) checkIdentity();
            if (!cmsLoaded && typeof CMS !== 'undefined') checkCMS();
        }, 1000);
        
        // Timeout de seguran√ßa
        setTimeout(() => {
            if (!cmsLoaded) {
                updateStatus('‚ùå Timeout: CMS n√£o carregou', 'error');
                
                const ncRoot = document.getElementById('nc-root');
                if (ncRoot) {
                    ncRoot.innerHTML = `
                        <div class="error">
                            <h2>CMS n√£o carregou</h2>
                            <p>Status atual:</p>
                            <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
                                <li>Identity: ${identityLoaded ? '‚úÖ' : '‚ùå'}</li>
                                <li>CMS: ${cmsLoaded ? '‚úÖ' : '‚ùå'}</li>
                                <li>Config: ${configLoaded ? '‚úÖ' : '‚ùå'}</li>
                                <li>Fonte: ${scriptSource}</li>
                            </ul>
                            <p>Tente recarregar a p√°gina ou acessar o debug.</p>
                        </div>
                    `;
                }
            }
        }, 15000);
    </script>
</body>
</html>
